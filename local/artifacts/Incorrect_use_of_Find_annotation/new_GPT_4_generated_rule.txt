Rule incorrect-use-of-find-annotation {
  for (class c in getClasses()) {
    for (method m in getMethods(c)) {
      if (hasAnnotation(m, '@Find')) {
        String returnType = getReturnType(m);
        assert (returnType == 'E' OR returnType == 'java.util.List<E>' OR returnType == 'org.hibernate.query.Query<E>' OR returnType == 'org.hibernate.query.SelectionQuery<E>' OR returnType == 'jakarta.persistence.Query<E>' OR returnType == 'jakarta.persistence.TypedQuery<E>') {
          msg('Incorrect return type: %s for method: %s in class: %s', returnType, getName(m), getFQN(c));
        }
        for (String param in getParams(m)) {
          assert (exists(field f in getFields(c)) (getName(f) == param AND getType(f) == getType(param))) {
            msg('Parameter: %s in method: %s does not match any persistent field in class: %s', param, getName(m), getFQN(c));
          }
        }
      }
    }
  }
}
